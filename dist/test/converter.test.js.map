{"version":3,"file":"converter.test.js","sourceRoot":"","sources":["../../src/test/converter.test.ts"],"names":[],"mappings":";;AAAA,0BAAsF;AACtF,yBAAyB;AACzB,6BAA6B;AAC7B,iCAAkC;AAElC,SAAS,kBAAkB,CAAC,OAAO,EAAE,IAAI,EAAE,IAAa;IACpD,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC;IAC5C,MAAM,CAAC,SAAS,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IAEhC,KAAK,IAAI,GAAG,IAAI,IAAI,EAAE;QAClB,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;YAC3B,SAAS;SACZ;QACD,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,sBAAsB,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;KAClF;IAED,KAAK,IAAI,GAAG,IAAI,OAAO,EAAE;QACrB,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,KAAK,WAAW,EAAE;YACrE,SAAS;SACZ;QACD,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,sBAAsB,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;QAE5E,MAAM,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;QACvB,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;QACpB,MAAM,CAAC,CAAC,YAAY,MAAM,KAAK,CAAC,YAAY,MAAM,EAAE,IAAI,GAAG,cAAc,GAAG,GAAG,GAAG,iBAAiB,CAAC,CAAC;QAErG,IAAI,CAAC,YAAY,MAAM,EAAE;YACrB,QAAQ,GAAG,EAAE;gBACT,KAAK,YAAY,CAAC;gBAClB,KAAK,gBAAgB,CAAC;gBACtB,KAAK,UAAU;oBACX,eAAe,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;oBAC5B,MAAM;gBACV,KAAK,gBAAgB,CAAC;gBACtB,KAAK,cAAc,CAAC;gBACpB,KAAK,cAAc;oBACf,kBAAkB,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;oBAC/B,MAAM;gBACV;oBACI,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,GAAG,cAAc,GAAG,GAAG,GAAG,kBAAkB,CAAC,CAAC;aAChF;SACJ;aAAM;YACH,MAAM,CAAC,CAAC,KAAK,CAAC,EAAE,IAAI,GAAG,cAAc,GAAG,GAAG,GAAG,kBAAkB,CAAC,CAAC;SACrE;KACJ;AACL,CAAC;AAED,SAAS,eAAe,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI;IACxC,MAAM,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,UAAS,KAAK,IAAI,OAAO,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IAC5D,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,UAAS,KAAK,IAAI,OAAO,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IAEzD,MAAM,CAAC,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM,EAAE,IAAI,GAAG,8BAA8B,CAAC,CAAC;IACrE,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,UAAS,CAAC,EAAE,CAAC,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,GAAG,0BAA0B,CAAC,CAAC;IAE1F,OAAO,CAAC,OAAO,CAAC,UAAS,CAAC,EAAE,KAAK;QAC7B,kBAAkB,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;AACP,CAAC;AAED,QAAQ,CAAC,WAAW,EAAE;IAClB,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IAC/C,IAAI,GAAgB,CAAC;IAErB,MAAM,CAAC,YAAY,EAAE;QACjB,GAAG,GAAG,IAAI,eAAW,CAAC;YAClB,IAAI,EAAI,SAAS;YACjB,MAAM,EAAE,MAAM;YACd,MAAM,EAAE,KAAK;YACb,MAAM,EAAE,UAAU;YAClB,sBAAsB,EAAE,IAAI;YAC5B,GAAG,EAAE,OAAO;SACf,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,UAAU,SAAS;QAC5C,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACxC,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,EAAE;YACnC,OAAO;SACV;QAED,QAAQ,CAAC,SAAS,EAAE;YAChB,IAAI,MAAqC,CAAC;YAE1C,EAAE,CAAC,mBAAmB,EAAE;gBACpB,qBAAiB,EAAE,CAAC;gBACpB,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBACnD,MAAM,CAAC,MAAM,YAAY,qBAAiB,EAAE,wBAAwB,CAAC,CAAC;YAC1E,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,eAAe,EAAE;gBAChB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;gBACpF,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAO,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBAC1D,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAEtD,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;YAChD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AAEH,QAAQ,CAAC,wCAAwC,EAAE;IAC/C,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IAC/C,MAAM,kBAAkB,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,mBAAmB,CAAC,CAAC;IAChE,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IAC1C,IAAI,GAAgB,CAAC;IAErB,MAAM,CAAC,YAAY,EAAE;QACjB,GAAG,GAAG,IAAI,eAAW,CAAC;YAClB,IAAI,EAAI,SAAS;YACjB,MAAM,EAAE,MAAM;YACd,MAAM,EAAE,KAAK;YACb,MAAM,EAAE,UAAU;YAClB,sBAAsB,EAAE,IAAI;YAC5B,kBAAkB,EAAE,IAAI;YACxB,GAAG,EAAE,OAAO;SACf,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,IAAI,MAAqC,CAAC;IAE1C,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QAC/B,EAAE,CAAC,mBAAmB,EAAE;YACpB,qBAAiB,EAAE,CAAC;YACpB,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC;YACjE,MAAM,CAAC,MAAM,YAAY,qBAAiB,EAAE,wBAAwB,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,eAAe,EAAE;YAChB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,6BAA6B,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;YACnH,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAO,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YAC1D,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEtD,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,OAAO,EAAE,GAAG,EAAE;QACnB,EAAE,CAAC,mBAAmB,EAAE;YACpB,qBAAiB,EAAE,CAAC;YACpB,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YACvD,MAAM,CAAC,MAAM,YAAY,qBAAiB,EAAE,wBAAwB,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,eAAe,EAAE;YAChB,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,6BAA6B,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;YACzG,IAAI,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAO,CAAC,QAAQ,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YAC1D,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAa,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAEtD,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;IACP,CAAC,CAAC,CAAC;AAEP,CAAC,CAAC,CAAC","sourcesContent":["import { Application, resetReflectionID, normalizePath, ProjectReflection } from '..';\nimport * as FS from 'fs';\nimport * as Path from 'path';\nimport Assert = require('assert');\n\nfunction compareReflections(fixture, spec, path?: string) {\n    path = (path ? path + '/' : '') + spec.name;\n    Assert.deepEqual(fixture, spec);\n\n    for (let key in spec) {\n        if (!spec.hasOwnProperty(key)) {\n            continue;\n        }\n        Assert(fixture.hasOwnProperty(key), path + ': Missing property \"' + key + '\"');\n    }\n\n    for (let key in fixture) {\n        if (!fixture.hasOwnProperty(key) || typeof fixture[key] === 'undefined') {\n            continue;\n        }\n        Assert(spec.hasOwnProperty(key), path + ': Unknown property \"' + key + '\"');\n\n        const a = fixture[key];\n        const b = spec[key];\n        Assert(a instanceof Object === b instanceof Object, path + ': Property \"' + key + '\" type mismatch');\n\n        if (a instanceof Object) {\n            switch (key) {\n                case 'signatures':\n                case 'typeParameters':\n                case 'children':\n                    compareChildren(a, b, path);\n                    break;\n                case 'indexSignature':\n                case 'getSignature':\n                case 'setSignature':\n                    compareReflections(a, b, path);\n                    break;\n                default:\n                    Assert.deepEqual(a, b, path + ': Property \"' + key + '\" value mismatch');\n            }\n        } else {\n            Assert(a === b, path + ': Property \"' + key + '\" value mismatch');\n        }\n    }\n}\n\nfunction compareChildren(fixture, spec, path) {\n    const a = fixture.map(function(child) { return child.id; });\n    const b = spec.map(function(child) { return child.id; });\n\n    Assert(a.length === b.length, path + ': Number of children differs');\n    Assert(a.every(function(u, i) { return u === b[i]; }), path + ': Children are different');\n\n    fixture.forEach(function(a, index) {\n        compareReflections(a, spec[index], path);\n    });\n}\n\ndescribe('Converter', function() {\n    const base = Path.join(__dirname, 'converter');\n    let app: Application;\n\n    before('constructs', function() {\n        app = new Application({\n            mode:   'Modules',\n            logger: 'none',\n            target: 'ES5',\n            module: 'CommonJS',\n            experimentalDecorators: true,\n            jsx: 'react'\n        });\n    });\n\n    FS.readdirSync(base).forEach(function (directory) {\n        const path = Path.join(base, directory);\n        if (!FS.lstatSync(path).isDirectory()) {\n            return;\n        }\n\n        describe(directory, function() {\n            let result: ProjectReflection | undefined;\n\n            it('converts fixtures', function() {\n                resetReflectionID();\n                result = app.convert(app.expandInputFiles([path]));\n                Assert(result instanceof ProjectReflection, 'No reflection returned');\n            });\n\n            it('matches specs', function() {\n                const specs = JSON.parse(FS.readFileSync(Path.join(path, 'specs.json')).toString());\n                let data = JSON.stringify(result!.toObject(), null, '  ');\n                data = data.split(normalizePath(base)).join('%BASE%');\n\n                compareReflections(JSON.parse(data), specs);\n            });\n        });\n    });\n});\n\ndescribe('Converter with excludeNotExported=true', function() {\n    const base = Path.join(__dirname, 'converter');\n    const exportWithLocalDir = Path.join(base, 'export-with-local');\n    const classDir = Path.join(base, 'class');\n    let app: Application;\n\n    before('constructs', function() {\n        app = new Application({\n            mode:   'Modules',\n            logger: 'none',\n            target: 'ES5',\n            module: 'CommonJS',\n            experimentalDecorators: true,\n            excludeNotExported: true,\n            jsx: 'react'\n        });\n    });\n\n    let result: ProjectReflection | undefined;\n\n    describe('export-with-local', () => {\n        it('converts fixtures', function() {\n            resetReflectionID();\n            result = app.convert(app.expandInputFiles([exportWithLocalDir]));\n            Assert(result instanceof ProjectReflection, 'No reflection returned');\n        });\n\n        it('matches specs', function() {\n            const specs = JSON.parse(FS.readFileSync(Path.join(exportWithLocalDir, 'specs-without-exported.json')).toString());\n            let data = JSON.stringify(result!.toObject(), null, '  ');\n            data = data.split(normalizePath(base)).join('%BASE%');\n\n            compareReflections(JSON.parse(data), specs);\n        });\n    });\n\n    describe('class', () => {\n        it('converts fixtures', function() {\n            resetReflectionID();\n            result = app.convert(app.expandInputFiles([classDir]));\n            Assert(result instanceof ProjectReflection, 'No reflection returned');\n        });\n\n        it('matches specs', function() {\n            const specs = JSON.parse(FS.readFileSync(Path.join(classDir, 'specs-without-exported.json')).toString());\n            let data = JSON.stringify(result!.toObject(), null, '  ');\n            data = data.split(normalizePath(base)).join('%BASE%');\n\n            compareReflections(JSON.parse(data), specs);\n        });\n    });\n\n});\n"]}