{"version":3,"file":"TocPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/TocPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import { Reflection, ReflectionKind, ProjectReflection, DeclarationReflection } from '../../models/reflections/index';\nimport { Component, RendererComponent } from '../components';\nimport { PageEvent } from '../events';\nimport { NavigationItem } from '../models/NavigationItem';\n\n/**\n * A plugin that generates a table of contents for the current page.\n *\n * The table of contents will start at the nearest module or dynamic module. This plugin\n * sets the [[PageEvent.toc]] property.\n */\n@Component({name: 'toc'})\nexport class TocPlugin extends RendererComponent {\n    /**\n     * Create a new TocPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [PageEvent.BEGIN]: this.onRendererBeginPage\n        });\n    }\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onRendererBeginPage(page: PageEvent) {\n        let model = page.model;\n        if (!(model instanceof Reflection)) {\n            return;\n        }\n\n        const trail: Reflection[] = [];\n        while (!(model instanceof ProjectReflection) && !model.kindOf(ReflectionKind.SomeModule)) {\n            trail.unshift(model);\n            model = model.parent;\n        }\n\n        const tocRestriction = this.owner.toc;\n        page.toc = new NavigationItem();\n        TocPlugin.buildToc(model, trail, page.toc, tocRestriction);\n    }\n\n    /**\n     * Create a toc navigation item structure.\n     *\n     * @param model   The models whose children should be written to the toc.\n     * @param trail   Defines the active trail of expanded toc entries.\n     * @param parent  The parent [[NavigationItem]] the toc should be appended to.\n     * @param restriction  The restricted table of contents.\n     */\n    static buildToc(model: Reflection, trail: Reflection[], parent: NavigationItem, restriction?: string[]) {\n        const index = trail.indexOf(model);\n        const children = model['children'] || [];\n\n        if (index < trail.length - 1 && children.length > 40) {\n            const child = trail[index + 1];\n            const item = NavigationItem.create(child, parent, true);\n            item.isInPath  = true;\n            item.isCurrent = false;\n            TocPlugin.buildToc(child, trail, item);\n        } else {\n            children.forEach((child: DeclarationReflection) => {\n\n                if (restriction && restriction.length > 0 && restriction.indexOf(child.name) === -1) {\n                    return;\n                }\n\n                if (child.kindOf(ReflectionKind.SomeModule)) {\n                    return;\n                }\n\n                const item = NavigationItem.create(child, parent, true);\n                if (trail.indexOf(child) !== -1) {\n                    item.isInPath  = true;\n                    item.isCurrent = (trail[trail.length - 1] === child);\n                    TocPlugin.buildToc(child, trail, item);\n                }\n            });\n        }\n    }\n}\n"]}