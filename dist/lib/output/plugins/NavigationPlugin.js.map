{"version":3,"file":"NavigationPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/NavigationPlugin.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA,4CAA6D;AAE7D,oCAAqD;AAWrD;IAAsC,oCAAiB;IAAvD;;IAwEA,CAAC;IA/DG,qCAAU,GAAV;QACI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK;YACpB,GAAC,sBAAa,CAAC,KAAK,IAAG,IAAI,CAAC,eAAe;YAC3C,GAAC,kBAAS,CAAC,KAAK,IAAO,IAAI,CAAC,WAAW;gBACzC,CAAC;;IACP,CAAC;IAOO,0CAAe,GAAvB,UAAwB,KAAoB;QACxC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;IACpE,CAAC;IAOO,sCAAW,GAAnB,UAAoB,IAAe;QAC/B,IAAM,YAAY,GAAqB,EAAE,CAAC;QAC1C,CAAC,oBAAoB,IAAoB;YACrC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;YACvB,IAAI,CAAC,QAAQ,GAAI,KAAK,CAAC;YACvB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;YAEhC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC/F,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC5B,CAAC;YAED,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAChB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,KAAK,IAAK,OAAA,UAAU,CAAC,KAAK,CAAC,EAAjB,CAAiB,CAAC,CAAC;YACxD,CAAC;QACL,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAEpB,YAAY,CAAC,OAAO,CAAC,UAAC,IAAoB;YACtC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YAEtB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACpC,IAAI,KAAK,GAAG,CAAC,CAAC;YACd,OAAO,IAAI,EAAE,CAAC;gBACV,IAAI,CAAC,QAAQ,GAAI,IAAI,CAAC;gBACtB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBAEtB,KAAK,IAAI,CAAC,CAAC;gBACX,KAAK,IAAI,CAAC,CAAC;gBACX,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;oBAChB,KAAK,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;oBAC9B,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC;wBAC1B,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAC,KAAK;4BACxB,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC;wBAC3B,CAAC,CAAC,CAAC;oBACP,CAAC;gBACL,CAAC;gBAED,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC;YACvB,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;IACtC,CAAC;IAvEQ,gBAAgB;QAD5B,sBAAS,CAAC,EAAC,IAAI,EAAE,YAAY,EAAC,CAAC;OACnB,gBAAgB,CAwE5B;IAAD,uBAAC;CAAA,AAxED,CAAsC,8BAAiB,GAwEtD;AAxEY,4CAAgB","sourcesContent":["import { Component, RendererComponent } from '../components';\nimport { NavigationItem } from '../models/NavigationItem';\nimport { RendererEvent, PageEvent } from '../events';\n\n/**\n * A plugin that exposes the navigation structure of the documentation\n * to the rendered templates.\n *\n * The navigation structure is generated using the current themes\n * [[BaseTheme.getNavigation]] function. This plugins takes care that the navigation\n * is updated and passed to the render context.\n */\n@Component({name: 'navigation'})\nexport class NavigationPlugin extends RendererComponent {\n    /**\n     * The navigation structure generated by the current theme.\n     */\n    navigation: NavigationItem;\n\n    /**\n     * Create a new NavigationPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [RendererEvent.BEGIN]: this.onBeginRenderer,\n            [PageEvent.BEGIN]:     this.onBeginPage\n        });\n    }\n\n    /**\n     * Triggered before the renderer starts rendering a project.\n     *\n     * @param event  An event object describing the current render operation.\n     */\n    private onBeginRenderer(event: RendererEvent) {\n        this.navigation = this.owner.theme.getNavigation(event.project);\n    }\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onBeginPage(page: PageEvent) {\n        const currentItems: NavigationItem[] = [];\n        (function updateItem(item: NavigationItem) {\n            item.isCurrent = false;\n            item.isInPath  = false;\n            item.isVisible = item.isGlobals;\n\n            if (item.url === page.url || (item.dedicatedUrls && item.dedicatedUrls.indexOf(page.url) !== -1)) {\n                currentItems.push(item);\n            }\n\n            if (item.children) {\n                item.children.forEach((child) => updateItem(child));\n            }\n        })(this.navigation);\n\n        currentItems.forEach((item: NavigationItem) => {\n            item.isCurrent = true;\n\n            let depth = item.isGlobals ? -1 : 0;\n            let count = 1;\n            while (item) {\n                item.isInPath  = true;\n                item.isVisible = true;\n\n                count += 1;\n                depth += 1;\n                if (item.children) {\n                    count += item.children.length;\n                    if (depth < 2 || count < 30) {\n                        item.children.forEach((child) => {\n                            child.isVisible = true;\n                        });\n                    }\n                }\n\n                item = item.parent;\n            }\n        });\n\n        page.navigation = this.navigation;\n    }\n}\n"]}