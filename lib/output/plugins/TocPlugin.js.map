{"version":3,"file":"TocPlugin.js","sourceRoot":"","sources":["../../../src/lib/output/plugins/TocPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import {Reflection, ReflectionKind, ProjectReflection, DeclarationReflection} from \"../../models/reflections/index\";\nimport {Component, RendererComponent} from \"../components\";\nimport {PageEvent} from \"../events\";\nimport {NavigationItem} from \"../models/NavigationItem\";\n\n\n/**\n * A plugin that generates a table of contents for the current page.\n *\n * The table of contents will start at the nearest module or dynamic module. This plugin\n * sets the [[PageEvent.toc]] property.\n */\n@Component({name:\"toc\"})\nexport class TocPlugin extends RendererComponent\n{\n    /**\n     * Create a new TocPlugin instance.\n     */\n    initialize() {\n        this.listenTo(this.owner, {\n            [PageEvent.BEGIN]: this.onRendererBeginPage\n        });\n    }\n\n\n    /**\n     * Triggered before a document will be rendered.\n     *\n     * @param page  An event object describing the current render operation.\n     */\n    private onRendererBeginPage(page:PageEvent) {\n        var model = page.model;\n        if (!(model instanceof Reflection)) {\n            return;\n        }\n\n        var trail:Reflection[] = [];\n        while (!(model instanceof ProjectReflection) && !model.kindOf(ReflectionKind.SomeModule)) {\n            trail.unshift(model);\n            model = model.parent;\n        }\n\n        page.toc = new NavigationItem();\n        TocPlugin.buildToc(model, trail, page.toc);\n    }\n\n\n    /**\n     * Create a toc navigation item structure.\n     *\n     * @param model   The models whose children should be written to the toc.\n     * @param trail   Defines the active trail of expanded toc entries.\n     * @param parent  The parent [[NavigationItem]] the toc should be appended to.\n     */\n    static buildToc(model:Reflection, trail:Reflection[], parent:NavigationItem) {\n        var index = trail.indexOf(model);\n        var children = model['children'] || [];\n\n        if (index < trail.length - 1 && children.length > 40) {\n            var child = trail[index + 1];\n            var item = NavigationItem.create(child, parent, true);\n            item.isInPath  = true;\n            item.isCurrent = false;\n            TocPlugin.buildToc(child, trail, item);\n        } else {\n            children.forEach((child:DeclarationReflection) => {\n                if (child.kindOf(ReflectionKind.SomeModule)) {\n                    return;\n                }\n\n                var item = NavigationItem.create(child, parent, true);\n                if (trail.indexOf(child) != -1) {\n                    item.isInPath  = true;\n                    item.isCurrent = (trail[trail.length - 1] == child);\n                    TocPlugin.buildToc(child, trail, item);\n                }\n            });\n        }\n    }\n}\n"]}